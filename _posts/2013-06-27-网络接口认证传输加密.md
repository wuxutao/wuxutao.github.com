---
layout: post
category : 安全 
tags : [RSA, 认证, 传输, 公钥, 私钥, 安全]
---
> 顺，不妄喜；逆，不惶馁；安，不奢逸；危，不惊惧；胸有惊雷而面如平湖者，可拜上将军

最近要出一套http接口，供客户端调用，非浏览器，也不同于OAUTH协议；
其中涉及到客户的认证和传输的加密，去网上找了些非对称加密、数字签名资料及参考OAUTH，初步方案如下:

###基本概念
<ul>
<li>私有性-保证通信信息在传输过程中不能被第三方窃听者破译</li>
<li>完整性：接收方能检测出信息在网络传输过程中是否被篡改</li>
<li>确认性：接收方能有效地对发送方的身份进行认证</li>
<li>不可否认性：接收方一旦接收到发送方的有效信息，发送在事后无法予以第來</li>
<li>摘要算法：MD5，用来进行完整性验证，对内容生成定长字符串，不可逆，称为消息摘要或者数据指纹</li>
<li>数字签名：</li>
	<ol>
    <li>数据M</li>
    <li>M经MD5加密生成数据摘要MD</li>
    <li>用非对称算法和自己的私钥对MD进行加密，该密文就是S就是数据M的数字签名</li>
    <li>接收者用公钥解密S，获得信息MD5-1</li>
    <li>接收者生成信息M的MD5-2</li>
    <li>比较MD5-1和MD5-2，如一致，则数据未被篡改</li>
    <li>因为公钥只能解密对应私钥产生的数据，所以可验证不可否认行</li>
	</ol>
<li>数字信封：组合应用对称及非对称加密算法，用于通信双方间的安全文件交换</li>
	<ol>
    <li>数据M</li>
    <li>生成一个随机数</li>
    <li>用随机数作为密钥对M进行对称加密</li>
    <li>用公钥对随机数进行非对称加密，生成信封</li>
    <li>接收方用私钥对信封进行解密，得到密钥（随机数）</li>
    <li>用密钥对数据进行解密</li>
    </ol>
</ul>
###基本元素
- RSA算法,DES算法,MD5算法
- 客户的一套公钥(CPub)、私钥(CPri)
- 服务端的一套公钥(SPub)、私钥(SPri)
- 客户唯一标识id
- 随机数RC--作为对称加密的公钥
- 合同（即客户端想要提供给服务方的数据）M
- 组合数据（IM），有id+M构成的字符串

###交互方式及顺序
1. 服务端提供给用户该服务密钥Spub及唯一标识id（32bytes字符串）
2. 用户访问服务的参数包含&data(加密的IM),&key（加密的RC）,&signature（数字签名）三部分
3. 用户Key生成：用SPub及RSA算法对RC进行加密，即为key值
4. 用户生成data：用RC作为DES算法密钥对IM进行加密，即生成data
5. 用户生成signature:
    - 用md5算法对id+M组成的字符串生成信息摘要；
    - 用客户的私钥CPri经RSA对信息摘要生成数据签名

6. 服务端接收到数据后：
    - 用私钥解析key,获得RC
    - 用RC解析data,获得IM
    - 用IM中的Id数据获得是哪个用户
    - 用该用户的私钥解析signature，获取摘要即md5-1
    - 用MD5算法对解析的IM数据机型MD5运算,生成md5-2
    - 对比md5-1与md5-2，如相同，则是对应用户发送的未经篡改的数据
